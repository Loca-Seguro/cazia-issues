name: Telegram Notifications for Issues
on:
  issues:
    # Captura a abertura (In√≠cio) e o r√≥tulo removido (Fim da Triagem)
    types: [opened, unlabeled] 
  issue_comment:
    types: [created]

jobs:
  notify_issue_opened:
    # Dispara ao abrir uma nova issue.
    if: github.event_name == 'issues' && github.event.action == 'opened'
    runs-on: ubuntu-latest
    steps:
      - name: Send New Issue Notification
        uses: appleboy/telegram-action@master
        with:
          to: ${{ secrets.TELEGRAM_CHAT_ID }}
          token: ${{ secrets.TELEGRAM_TOKEN }}
          parse_mode: markdown
          message: |
            üîî *NOVA ISSUE RECEBIDA*
            
            *T√≠tulo:* `${{ github.event.issue.title }}`
            *Repo:* `${{ github.repository }}`
            
            *Status:* ‚ö†Ô∏è AGUARDANDO TRIAGEM
            [Abrir Issue](${{ github.event.issue.html_url }})
          
  notify_triage_complete:
    # Dispara quando um r√≥tulo √© removido E esse r√≥tulo era o 'to triage'.
    if: github.event_name == 'issues' && github.event.action == 'unlabeled' && github.event.label.name == 'to triage'
    runs-on: ubuntu-latest
    steps:
      - name: Send Triage Complete Notification
        uses: appleboy/telegram-action@master
        with:
          to: ${{ secrets.TELEGRAM_CHAT_ID }}
          token: ${{ secrets.TELEGRAM_TOKEN }}
          parse_mode: markdown
          message: |
            ‚úÖ *TRIAGEM CONCLU√çDA - PRONTA PARA DEV*
            
            *Issue:* `${{ github.event.issue.title }}`
            
            *Status:* Triagem Finalizada\.
            *R√≥tulos Atuais:* ${{ join(github.event.issue.labels.*.name, ', ') }}
            
            [Come√ßar Desenvolvimento](${{ github.event.issue.html_url }})